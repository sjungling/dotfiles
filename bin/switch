#!/usr/bin/env ruby
CONFIG_PATH="/etc/apache2/other"

def disable_servers
  system("find #{CONFIG_PATH} -name '*.conf' -exec mv {} {}.disabled \\;")
end

def enable_server(server)
  system("mv #{CONFIG_PATH}/#{server}.conf.disabled #{CONFIG_PATH}/#{server}.conf")
end

def restart_apache
  system('apachectl restart')
end

def reload_app
  system('curl -s -I "http://local.build.com/?resetApp=1"')
end

disable_servers
case ARGV[0]
when "new"
  enable_server("new.build")
when "current"
  enable_server("build")
when "dps"
  enable_server("dps")
when "mobile"
  enable_server("mobile")
when "omc"
  enable_server("omc")
when "mmc"
  enable_server("mmc")
else
  STDOUT.puts <<-EOF
Switch - Makes it easy to bounce back and forth between loading current and new Build Apache confs

Usage:
  sudo switch [current|new|dps|mobile|omc]
  sudo switch current
EOF
end
restart_apache
reload_app